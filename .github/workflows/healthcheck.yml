name: Healthcheck API
on:
  schedule: [{ cron: "*/30 * * * *" }]
  workflow_dispatch:
jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Check /api/health
        run: |
          set -e
          curl -sS https://runart-foundry.pages.dev/api/health | jq -e '.ok==true and .env=="production"'
      - name: Open issue on failure
        if: failure()
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          TITLE="Healthcheck FAIL $(date -u +%Y-%m-%dT%H:%M:%SZ)"
          gh issue create --title "$TITLE" --body "El endpoint /api/health devolvi√≥ error. Revisar overlay/Pages/Access." || true
