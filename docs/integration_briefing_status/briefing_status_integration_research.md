# Investigaci√≥n: Integraci√≥n Briefing + status.json + Publicaciones Automatizadas

**Fecha:** 2025-10-23  
**Autor:** GitHub Copilot (Research Phase)  
**Rama:** `feat/briefing-status-integration-research`

---

## 1. Resumen Ejecutivo

**Conclusi√≥n inicial:** La integraci√≥n √≥ptima combina **MkDocs con macros Jinja** para renderizar `status.json` en p√°ginas est√°ticas del Briefing, junto con un **pipeline CI/CD en Python** para generar publicaciones automatizadas a partir de commits documentales.

**Recomendaci√≥n base:**
- Usar **mkdocs-macros-plugin** o plantillas Jinja directas para integrar `status.json` en `apps/briefing/docs/status/index.md`
- Crear scripts Python (`tools/render_status.py`, `tools/commits_to_posts.py`) ejecutados en GitHub Actions post-merge
- PaperLang queda como opci√≥n **opt-in** para papers narrativos complejos (no necesario para PoC)
- Mantener CI verde con validaciones estrictas de frontmatter y formato Markdown

**Ventajas clave:**
- üöÄ Despliegue ‚â§5min post-merge
- üîí 100% consistencia entre datos y vista renderizada
- üõ°Ô∏è Cero dependencias externas cr√≠ticas (MkDocs ya usado en proyecto)
- üìä KPIs operativos visibles en tiempo real
- ü§ñ Auto-posts sin intervenci√≥n manual

---

## 2. Modelos de Integraci√≥n

### Modelo A: MkDocs Directo (Recomendado para PoC)

**Descripci√≥n:** Usar MkDocs con plugins para inyectar datos de `status.json` directamente en Markdown.

**Opciones t√©cnicas:**
1. **mkdocs-macros-plugin** ‚Äî Jinja macros con acceso a `extra:` en `mkdocs.yml`
   ```yaml
   extra:
     status: !include docs/status.json
   ```
   ```markdown
   {{ status.docs_live_count }} documentos activos
   ```

2. **markdownextradata-plugin** ‚Äî Similar, pero m√°s expl√≠cito para JSON externos
   ```yaml
   plugins:
     - markdownextradata:
         data: docs
   ```
   ```markdown
   {{ status.docs_live_count }}
   ```

3. **Hook Python personalizado** ‚Äî `on_pre_build` en `mkdocs.yml`
   ```python
   def on_pre_build(config):
       with open('docs/status.json') as f:
           config['extra']['status'] = json.load(f)
   ```

**Pros:**
- ‚úÖ Integraci√≥n nativa con MkDocs (ya usado en Briefing)
- ‚úÖ Sin compilaci√≥n adicional (build est√°ndar)
- ‚úÖ Hot-reload funcional en desarrollo (`mkdocs serve`)
- ‚úÖ Fallback sencillo (JSON ‚Üí defaults si falla carga)
- ‚úÖ Mantenibilidad alta (plantillas Jinja conocidas)

**Contras:**
- ‚ö†Ô∏è Requiere regenerar `status.json` antes de cada build
- ‚ö†Ô∏è No valida esquema JSON autom√°ticamente (necesita script extra)
- ‚ö†Ô∏è Limitado a datos est√°ticos (no queries din√°micos)

**Caso de uso ideal:** P√°ginas `/status` con KPIs operativos actualizados post-merge.

---

### Modelo B: PaperLang (Opt-in para Papers)

**Descripci√≥n:** Framework especializado para publicaciones cient√≠ficas/t√©cnicas con narrativa compleja.

**Caracter√≠sticas:**
- Soporte para referencias cruzadas, bibliograf√≠a, diagramas embebidos
- Exportaci√≥n a PDF, LaTeX, HTML enriquecido
- Templating avanzado con variables y l√≥gica condicional

**Pros:**
- ‚úÖ Ideal para **papers t√©cnicos** con secciones numeradas, citas, gr√°ficos
- ‚úÖ Calidad tipogr√°fica superior (LaTeX backend)
- ‚úÖ Manejo de versiones (drafts, reviews, published)

**Contras:**
- ‚ö†Ô∏è Dependencia externa adicional (npm/pip + configuraci√≥n)
- ‚ö†Ô∏è Curva de aprendizaje media-alta
- ‚ö†Ô∏è Overkill para publicaciones simples tipo blog
- ‚ö†Ô∏è Build m√°s lento que MkDocs plain

**Caso de uso ideal:** Informes t√©cnicos trimestrales, whitepapers, RFCs extensos.

**Decisi√≥n:** **No prioritario para PoC**. Se mantiene como opci√≥n para casos espec√≠ficos donde se requiera formateo acad√©mico riguroso.

---

### Modelo C: CI/CD Directo (Recomendado para Auto-posts)

**Descripci√≥n:** Scripts Python ejecutados en GitHub Actions que generan Markdown directamente.

**Flujo t√≠pico:**
1. **Trigger:** Push a `main` (post-merge)
2. **Paso 1:** Ejecutar `scripts/gen_status.py` ‚Üí actualiza `docs/status.json`
3. **Paso 2:** Ejecutar `tools/render_status.py` ‚Üí lee JSON, genera `apps/briefing/docs/status/index.md`
4. **Paso 3:** Ejecutar `tools/commits_to_posts.py` ‚Üí extrae commits recientes, genera `apps/briefing/docs/news/*.md`
5. **Paso 4:** Validar frontmatter con linters strict
6. **Paso 5:** Commit + push (bot) o PR autom√°tico
7. **Paso 6:** Build de MkDocs con archivos actualizados

**Pros:**
- ‚úÖ **Control total** sobre generaci√≥n de contenido
- ‚úÖ L√≥gica compleja permitida (filtros, agregaciones, templates din√°micos)
- ‚úÖ Testeable localmente (`python tools/render_status.py`)
- ‚úÖ Auditable (commits bot identificables)
- ‚úÖ Rollback sencillo (revertir commit)

**Contras:**
- ‚ö†Ô∏è Requiere configurar bot account con permisos de escritura
- ‚ö†Ô∏è Riesgo de loops infinitos (commit ‚Üí CI ‚Üí commit ‚Üí ...) ‚Äî mitigar con `[skip ci]` o condiciones
- ‚ö†Ô∏è Latencia adicional (1-3 min) entre merge y publicaci√≥n visible

**Caso de uso ideal:** Auto-posts de actualizaciones documentales, summaries de PRs, dashboards din√°micos.

---

## 3. Formatos Compatibles

### JSON ‚Üí Markdown

**Estrategias de conversi√≥n:**

1. **Tablas Markdown** (para m√©tricas estructuradas)
   ```python
   def render_table(data: dict) -> str:
       return f"""
   | M√©trica | Valor |
   |---------|-------|
   | Docs activos | {data['docs_live_count']} |
   | Docs archivados | {data['archive_count']} |
   | √öltimo commit | `{data['last_ci_ref'][:8]}` |
   """
   ```

2. **Badges din√°micos** (para CI health)
   ```markdown
   ![Live Docs](https://img.shields.io/badge/live-6-brightgreen)
   ![Archive](https://img.shields.io/badge/archive-1-blue)
   ![CI](https://img.shields.io/badge/build-passing-success)
   ```

3. **Gr√°ficos embebidos** (con Mermaid o Chart.js)
   ```markdown
   ```mermaid
   pie title "Distribuci√≥n de documentos"
       "Live" : 6
       "Archive" : 1
   ```
   ```

### JSON ‚Üí HTML (fallback)

Para casos donde Markdown no sea suficiente:
```html
<div class="status-dashboard">
  <h2>Estado Operativo</h2>
  <dl>
    <dt>Documentos activos</dt>
    <dd>{{ docs_live_count }}</dd>
  </dl>
</div>
```

---

## 4. Estrategias de Actualizaci√≥n

### Opci√≥n 1: Post-commit (inmediato, riesgoso)

**Trigger:** Pre-commit hook o post-commit
```bash
#!/bin/bash
# .git/hooks/pre-commit
python3 scripts/gen_status.py
git add docs/status.json
```

**Pros:** Actualizaci√≥n instant√°nea  
**Contras:** Ruido en commits, potencial corrupci√≥n si script falla

### Opci√≥n 2: Post-merge (recomendado)

**Trigger:** GitHub Actions on push to `main`
```yaml
on:
  push:
    branches: [main]
    paths:
      - 'docs/live/**'
      - 'docs/archive/**'
```

**Pros:**
- Actualizaciones solo en main (no en feature branches)
- CI auditable y testeable
- Rollback sencillo

**Contras:** Latencia de 1-3 min hasta visibilidad

### Opci√≥n 3: Scheduled (backup, no principal)

**Trigger:** Cron diario/semanal
```yaml
on:
  schedule:
    - cron: '0 6 * * 1'  # Lunes 06:00 UTC
```

**Uso:** Fallback si post-merge falla, snapshot semanal

---

## 5. Costos y Mantenibilidad

### Dependencias

| Componente | Tipo | Costo de Mantenimiento | Riesgo |
|------------|------|------------------------|--------|
| MkDocs | Runtime | Bajo (versi√≥n stable, releases lentos) | Bajo |
| mkdocs-macros-plugin | Plugin | Bajo (comunidad activa) | Bajo |
| markdownextradata | Plugin alternativo | Medio (menos popular) | Medio |
| PaperLang | Opcional | Alto (menos maduro) | Alto |
| Python scripts custom | In-house | Medio (requiere docs) | Medio |
| GitHub Actions | CI/CD | Bajo (plataforma estable) | Bajo |

**Recomendaci√≥n:** Priorizar MkDocs + scripts Python in-house. Evitar dependencias poco mantenidas.

### Curva de Aprendizaje

- **MkDocs macros:** 1-2 horas (Jinja b√°sico)
- **Scripts Python:** 2-4 horas (l√≥gica de negocio)
- **GitHub Actions:** 2-3 horas (sintaxis YAML, secrets)
- **PaperLang:** 8-12 horas (si se usa en futuro)

**Total estimado (PoC):** 5-9 horas para desarrollador con experiencia Python/CI.

### Gobernanza

**¬øQui√©n ajusta plantillas?**
- Equipo de docs (cambios visuales/estructura)
- Scripts Python ‚Üí c√≥digo revisado en PRs con owners en CODEOWNERS

**Versionado de esquema:**
```json
{
  "schema_version": "1.0",
  "generated_at": "...",
  ...
}
```

**Changelog:**
- `docs/_meta/STATUS_SCHEMA.md` documenta cambios entre versiones
- Breaking changes requieren migraci√≥n documentada

---

## 6. Riesgos y Mitigaci√≥n

### Riesgo 1: JSON inv√°lido

**Escenario:** `gen_status.py` falla, genera JSON malformado.

**Impacto:** Build de MkDocs falla, Briefing no se publica.

**Mitigaci√≥n:**
- Validar JSON con `jsonschema` en CI antes de commit
- Fallback a `status.json.bak` (snapshot anterior v√°lido)
- Tests unitarios de `gen_status.py`

```python
# tools/validate_status_schema.py
import jsonschema

schema = {
    "type": "object",
    "required": ["generated_at", "docs_live_count", "archive_count"],
    "properties": {
        "generated_at": {"type": "string"},
        "docs_live_count": {"type": "integer", "minimum": 0},
        ...
    }
}

with open('docs/status.json') as f:
    jsonschema.validate(json.load(f), schema)
```

### Riesgo 2: Drift entre status.json y realidad

**Escenario:** `status.json` muestra 6 docs, pero hay 8 en `docs/live/`.

**Impacto:** P√©rdida de confianza en KPIs, debugging manual necesario.

**Mitigaci√≥n:**
- **Validaci√≥n peri√≥dica:** CI semanal que re-genera status.json y compara con versi√≥n committed
- **Alertas:** Si diff > threshold, notificar a owners
- **Auditor√≠a:** Logs de cada generaci√≥n en `docs/_meta/BRIEFING_STATUS_PIPELINE_RUN.md`

### Riesgo 3: Ruptura de build por cambios en MkDocs

**Escenario:** Actualizaci√≥n de MkDocs 1.x ‚Üí 2.x rompe macros.

**Impacto:** Briefing no se publica, downtime.

**Mitigaci√≥n:**
- **Pinning de versiones:** `mkdocs==1.5.3` en `requirements.txt`
- **Renovate/Dependabot:** PRs autom√°ticos de updates, revisi√≥n manual
- **Tests de integraci√≥n:** Build local + CI antes de merge

### Riesgo 4: Loop infinito en CI

**Escenario:** Workflow genera commit ‚Üí trigger workflow ‚Üí genera commit ‚Üí ...

**Impacto:** Miles de commits spam, rate limits de GitHub.

**Mitigaci√≥n:**
- **Skip CI en commits bot:** `git commit -m "chore: update status [skip ci]"`
- **Condici√≥n en workflow:**
  ```yaml
  if: github.event.head_commit.author.name != 'github-actions[bot]'
  ```
- **Rate limiting:** Max 1 ejecuci√≥n por 5 minutos

---

## 7. PoC Propuesta

### Arquitectura

```
scripts/gen_status.py
    ‚Üì (genera docs/status.json)
tools/render_status.py
    ‚Üì (lee JSON, aplica template Jinja, escribe apps/briefing/docs/status/index.md)
tools/commits_to_posts.py
    ‚Üì (git log ‚Üí extrae commits docs/*, genera apps/briefing/docs/news/*.md)
MkDocs build
    ‚Üì (convierte Markdown ‚Üí HTML est√°tico)
GitHub Pages / Cloudflare Pages
    ‚Üì (publica sitio)
```

### Componentes m√≠nimos

1. **Template Jinja:** `tools/templates/status_page.md.j2`
   ```jinja
   ---
   title: "Estado Operativo"
   updated: "{{ status.generated_at }}"
   ---
   
   ## KPIs
   
   - **Documentos activos:** {{ status.docs_live_count }}
   - **Documentos archivados:** {{ status.archive_count }}
   - **√öltimo commit CI:** `{{ status.last_ci_ref[:8] }}`
   ```

2. **Script render:** `tools/render_status.py`
   ```python
   from jinja2 import Template
   import json
   
   with open('docs/status.json') as f:
       status = json.load(f)
   
   with open('tools/templates/status_page.md.j2') as f:
       template = Template(f.read())
   
   output = template.render(status=status)
   
   with open('apps/briefing/docs/status/index.md', 'w') as f:
       f.write(output)
   ```

3. **Script posts:** `tools/commits_to_posts.py` (ver secci√≥n 8 para detalle)

### Validaciones

- ‚úÖ JSON schema validation (`tools/validate_status_schema.py`)
- ‚úÖ Frontmatter validation (reutilizar `scripts/validate_docs_strict.py`)
- ‚úÖ Link checker (interno + externo)
- ‚úÖ Build de MkDocs exitoso (`mkdocs build --strict`)

---

## 8. Comparativa Final

| Criterio | MkDocs Macros | PaperLang | CI/CD Python |
|----------|---------------|-----------|--------------|
| **Complejidad** | Baja | Media-Alta | Media |
| **Flexibilidad** | Media | Alta | Alta |
| **Mantenibilidad** | Alta | Media | Alta |
| **Curva aprendizaje** | Baja | Alta | Media |
| **Build time** | R√°pido (<30s) | Medio (1-2min) | R√°pido (<1min) |
| **Fallback** | S√≠ (defaults) | No | S√≠ (commits revert) |
| **Testing local** | S√≠ | Limitado | S√≠ |
| **Uso ideal** | KPIs est√°ticos | Papers t√©cnicos | Auto-posts din√°micos |

**Decisi√≥n final:** **MkDocs Macros (status) + CI/CD Python (posts)** ‚Äî balance √≥ptimo entre simplicidad, flexibilidad y mantenibilidad.

---

## 9. Siguiente Paso: Plan de Implementaci√≥n

Ver `docs/integration_briefing_status/plan_briefing_status_integration.md` para roadmap detallado (S1/S2/S3), KPIs y gobernanza.

---

**Fecha:** 2025-10-23T22:10:00Z  
**Commit:** (pendiente de PR)  
**Autor:** GitHub Copilot (Briefing Status Integration Research)
