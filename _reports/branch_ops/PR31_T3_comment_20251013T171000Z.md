# PR #31 — T3 (Smokes autenticados) — Resumen y próximos pasos

## Preview
- Run: https://github.com/RunArtFoundry/runart-foundry/actions/runs/18473160346
- URL: https://8f745766.runart-foundry.pages.dev
- Público (Access 30x): PASS/WARN
- Autenticado (Service Token): FAIL
- Evidencias: `apps/briefing/_reports/smokes_preview_20251013T170812Z/`, `apps/briefing/_reports/tests/T3_e2e/20251013T170900Z/`
- Diagnóstico: `/api/whoami` devuelve `role: "admin"` para owner/team/client_admin/visitor. Se envían headers `CF-Access-Client-Id/Secret` del Service Token.

## Preview2
- Run: https://github.com/RunArtFoundry/runart-foundry/actions/runs/18472917793
- URL: https://1d18c874.runart-foundry.pages.dev
- Público (Access 30x): PASS
- Autenticado (Service Token): PASS
- Evidencias: `apps/briefing/_reports/smokes_preview2_20251013T165921Z/`, `apps/briefing/_reports/tests/T3_e2e/20251013T170900Z/`

## Próximos pasos sugeridos
1. Revisar bindings/ENV en Cloudflare Pages (Preview): `ACCESS_ADMINS`, `ACCESS_CLIENT_ADMINS`, `RUNART_ROLES` (KV) y audiencia del Service Token para hash pages.dev actual.
2. Confirmar que `resolveRole` y `getEmailFromRequest` reciben el correo esperado: headers permitidos (cf-access-authenticated-user-email, X-RunArt-Test-Email).
3. Opcional temporal: aceptar `admin` como equivalente de `owner` en los smokes de Preview hasta ajustar configuración.

> Nota: El extractor de preview_url quedó estable (API Cloudflare + fallback), y los smokes públicos toleran 301/302 hacia Access.
